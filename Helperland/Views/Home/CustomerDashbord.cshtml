@using Microsoft.AspNetCore.Http
@model IEnumerable<Helperland_projectContext.Models.ServiceRequest>
<link rel="stylesheet" href="~/css/Service-History.css" />
<script src="https://use.fontawesome.com/48380cf6ab.js"></script>

<partial name="~/Views/Shared/Header2.cshtml" />


<!--Welcome Sandip -->
<section class="mb-5">
  <div class="container-fluid welcome-sandip d-flex flex-column text-center justify-content-center align-items-center">
    <h1 class="welcome">Welcome,<span class="sandip"> @Context.Session.GetString("UserName_Session")! </span></h1>
  </div>     
  <section class="container-fluid pt-3">
    <div class=" row ">
      <div class="col-lg-3 col-12 tabs-menu me-0 pe-0">
        <nav class="navbar navbar-expand-lg navbar-light p-0">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-list" aria-controls="navbar-list" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse text-light" id="navbar-list">
            <ul class="nav tabs nav-pills justify-content-center align-content-start flex-column text-center text-xl-start">
              <li class="nav-item">
                <a class="nav-link" id="tabs-D" data-bs-toggle="pill" data-bs-target="#tabs-Dashbord" aria-controls="tabs-Dashbord" aria-selected="false">Dashbord</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="tabs-SH" data-bs-toggle="pill" data-bs-target="#tabs-Service-History" aria-controls="tabs-Service-History" aria-selected="false">Service History</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="tabs-SS" data-bs-toggle="pill" data-bs-target="#tabs-Service-Schedule" aria-controls="tabs-Service-Schedule" aria-selected="false">Service Schedule</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="tabs-FP" data-bs-toggle="pill" data-bs-target="#tabs-Favourite-Pros" aria-controls="tabs-Favourite-Pros" aria-selected="false">Favourite Pros</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="tabs-i" data-bs-toggle="pill" data-bs-target="#tabs-Invoices" aria-controls="tabs-Invoices" aria-selected="false">Invoices</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="tabs-N" data-bs-toggle="pill" data-bs-target="#tabs-Notifications" aria-controls="tabs-Notifications" aria-selected="false">Notifications</a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
      <div class="col-lg-9 col-12 ms-0 ps-0">
        <div class="tab-content description-part">
          <div class="tab-pane active accordian-collapse collapse" id="tabs-Dashbord" aria-labelledby="tabs-D">
            
        <div class="d-flex justify-content-between pb-2">
                <span class="text-1">Current Service Requests</span>
                <button class="book-now ps-2 pe-2" asp-action="BookService">Book Now!</button>
            </div>
            <table class="table border-box align-middle">
                <thead>
                <tr>
                    <th>Service ID</th>
                    <th>Service Details</th>
                    <th>Service Provider</th>
                    <th><span class="ps-1">Payment</span></th>
                    <th><span class="ps-5">Actions</span></th>
                </tr>
                </thead>
                <tbody>
                    @foreach ( var item in Model)
                    {
                        if(@item.Status == 0)
                        {
                            <tr class="mb-sm-3 mt-sm-3" >
                                <td id="popup" srid="@item.ServiceRequestId">@item.ServiceRequestId</td>
                                <td data-label="Service date" id="popup" srid="@item.ServiceRequestId"><img class="me-2" src="~/image/calendar.png">@item.ServiceStartDate.ToShortDateString() <br><img class="me-2"src="~/image/clock.png">@item.ServiceStartDate.ToLongTimeString()</td>
                                <td data-label="Service Provider" id="popup" srid="@item.ServiceRequestId"><div class="cap-star d-flex flex-wrap"><img class="cap me-2" src="~/image/cap.png"><div class="Service-Provider pb-0 d-flex flex-wrap">Lyum Watson<span class="star"><img src="~/image/yellow-star.png"><img src="~/image/yellow-star.png"><img src="~/image/yellow-star.png"><img src="~/image/yellow-star.png"><img src="~/image/white-star.png"></span>4</div></div></td>
                                <td data-label="Payment" id="popup" srid="@item.ServiceRequestId"><span class=" ps-1 number-63">@item.TotalCost</span></td>
                                <td><span><button class="reschedule p-1 m-1" id="res" data-id="@item.ServiceRequestId" onclick="reschedule(@item.ServiceRequestId)">Reschedule</button></span><span><button class="cancel p-1 m-1" id="Cancel" data-id="@item.ServiceRequestId" data-bs-toggle="modal" data-bs-target="#can">Cancel</button></span></td>
                            </tr>
                        }
                    }
                </tbody>
            </table>

          </div>
          <div class="tab-pane fade accordian-collapse collapse" id="tabs-Service-History" aria-labelledby="tabs-SH">
            
          </div>
          <div class="tab-pane fade accordian-collapse collapse" id="tabs-Service-Schedule" aria-labelledby="tabs-SS">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Laboriosam temporibus, illum consectetur deserunt impedit totam necessitatibus ratione quos obcaecati facilis suscipit,molestiae at aperiam debitis sed similique doloribus tempora numquam ut quibusdam officiis quis dolore quam. Porro et enim
              vero?
          </div>
          <div class="tab-pane fade accordian-collapse collapse" id="tabs-Favourite-Pros" aria-labelledby="tabs-FP">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Laboriosam temporibus, illum consectetur deserunt impedit totam necessitatibus ratione quos obcaecati facilis suscipit,molestiae at aperiam debitis sed similique doloribus tempora numquam ut quibusdam officiis quis dolore quam. Porro et enim
              vero?
          </div>
          <div class="tab-pane fade accordian-collapse collapse" id="tabs-Invoices" aria-labelledby="tabs-I">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Laboriosam temporibus, illum consectetur deserunt impedit totam necessitatibus ratione quos obcaecati facilis suscipit,molestiae at aperiam debitis sed similique doloribus tempora numquam ut quibusdam officiis quis dolore quam. Porro et enim
              vero?
          </div>
          <div class="tab-pane fade accordian-collapse collapse" id="tabs-Notifications" aria-labelledby="tabs-N">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Laboriosam temporibus, illum consectetur deserunt impedit totam necessitatibus ratione quos obcaecati facilis suscipit,molestiae at aperiam debitis sed similique doloribus tempora numquam ut quibusdam officiis quis dolore quam. Porro et enim
              vero?
          </div>
          
        </div>
      </div>
    </div>
  </section>
</section>


<div class="footer-navbar px-5 py-4 d-flex justify-content-between align-items-center flex-lg-row flex-column">
  <img class="mx-lg-4 ms-4 mb-lg-0 mb-3" src="~/image/logo-small.png">
  <ul class=" d-flex flex-lg-row gap-lg-4 gap-0 pe-lg-5 me-lg-5 text-center align-items-center flex-column ">
    <li class="mb-lg-0 mb-2">
      <a href="index.html">HOME</a>
    </li>
    <li class="mb-lg-0 mb-2">
      <a href="About.html">ABOUT</a>
    </li>
    <li class="mb-lg-0 mb-2">
      TESTIMONIALS
    </li>
    <li class="mb-lg-0 mb-2">
      <a href="FAQ.html">FAQs</a>
    </li>
    <li class="mb-lg-0 mb-2">
      INSURANCE POLICY
    </li>
    <li class="mb-lg-0 mb-2">
      IMPRESSUM
    </li>
  </ul>
  <div class="social-media">
    <img class="me-2 ps-4 " src="~/image/facebook.png">
    <img src="~/image/instagram.png">
  </div>
</div>
<div class="d-flex flex-column privacy-faq pb-3">
  <div class="footer-line"></div>
  <div class="text-center pt-3">©2018 Helperland. All rights reserved.     Terms and Conditions  |  Privacy Policy</div>
</div>


<!-- Modal -->
<div class="modal fade justify-content-center align-items-center" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body" id="popup-body">
      </div>

    </div>
  </div>
</div>

<!--Reschedule pop up model-->
    <div class="modal fade" id="Reschedule" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body" id="Reschedulebody">

                </div>
            </div>
        </div>
    </div>
<!--Cancel-->
<div class="modal fade" id="can" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <div>
          <span class="modal-title" id="exampleModalLabel">Cancel Service Request</span>
          <button type="button" class="btn-close x" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <span class="mt-2 model-head">Why do you want to cancel your service?</span><br>
        <input type="text" id="comments" class="Reason w-100" placeholder="Reason">

        <button class="update mt-2" id="cancelreq" type="button">Cancel</button>

      </div>
    </div>
  </div>
</div>

<script>
    $(document).on("click","#tabs-SH",function(){
        $("#tabs-Service-History").load("@Url.Action("CustomerServiceHistory","Home")")
    });
    function reschedule(id){
         console.log(id);
        $.ajax({
            type:"get",
            url: "@Url.Action("Reschedule","Home")",
            data : { id : id, isAjax : true },
            success: function(resp)
            {
                //console.log(resp);
                $("#Reschedulebody").html(resp);
                $("#Reschedule").modal('show');
            },
            error: function(err)
            {
                console.log(err);
                alert("error");
            }
        });
    }
    var resid;
    $(document).on("click","#res",function(){
        resid = $(this).attr('data-id');
    });
    $(document).on("click","#updatetime",function(){
        var obj ={};
        obj.id = parseInt(resid);
        obj.ServiceStartDate = $("#resdate").val();
        console.log(obj);
        $.ajax({
            type: "post",
            url: '@Url.Action("Updatetime","Home")',
            dataType : "json",
            data: JSON.stringify(obj),
            contentType: "application/json; charset=utf-8",
            async : true,
            cache : false,
            success: function(resp){
                console.log(resp);
                if(resp == true)
                {
                    alert(resp);
                    $("Reschedule").modal('hide');
                    location.reload();
                }
                else
                {
                    alert("something wrong");
                }
            },
            error: function(err){
                console.log(err);   
                alert("error");
            }
        });
    });
    var cancelid;
    $(document).on("click","#Cancel",function() {
        cancelid = $(this).attr('data-id');
        console.log(cancelid);
    });
    $(document).on("click","#cancelreq",function(){
        var obj ={};
        obj.id = parseInt(cancelid);
        obj.Comments = $("#comments").val();
        console.log(obj);
         $.ajax({
            url: '@Url.Action("DeleteReq", "Home")',
            type: "post",
            dataType : "json",
            contentType: "application/json; charset=utf-8",
            async : true,
            cache : false,
            data: JSON.stringify(obj),
            success: function(resp){
                alert(resp);
                location.reload();
            },
            error: function(err){
                console.log(err);   
                alert(err);
            }
        });
    });
    $(document).on("click","#popup",function(){
        var ServiceRequestId = parseInt($(this).attr('srid'));
        console.log(ServiceRequestId);
        $.ajax({
            type:"get",
            url: "@Url.Action("CDashbordPopup","Home")",
            data : { id :  parseInt($(this).attr('srid'))},
            success: function(resp)
            {
                //console.log(resp);
                $("#popup-body").html(resp);
                $("#exampleModal1").modal('show');
            },
            error: function(err)
            {
                console.log(err);
                alert("error");
            }    
        });
    });
    var srid,spid;
    $(document).on("click",".Rate-SP",function(){
        srid = parseInt($(this).attr('srid'));
        spid = parseInt($(this).attr('spid'));
        console.log(srid);
        console.log(spid);
    });
    $(document).on("click",".Rate-SP",function(){
            $.ajax({
                url: '@Url.Action("RateSP", "home")',
                type: 'GET',
                contentType: 'application/html; charset=utf-8',
                dataType: 'html',
                data: {
                    spid: parseInt($(this).attr("spid"))
                },
                success: function (res) {
                    console.log(res);
                    $("#ratesp .modal-body").html(res);
                    $("#ratesp").modal('show');
                },
                error: function (err) {
                    console.log(err);
                    console.log("Error");
                }
            });
    });
    $(document).on("click","#rateSubmit",function(){
        var rate = {};
        rate.Ratings = parseInt(x);
        rate.OnTimeArrival = parseInt(o);
        rate.Friendly = parseInt(f);
        rate.QualityOfService = parseInt(q);
        rate.Comments = $("#comments").val();
        rate.ServiceRequestId = parseInt(srid);
        rate.RatingTo = parseInt($("#id").val()); 
        console.log(rate);
        $.ajax({
            url: '@Url.Action("rate","Home")',
            type: 'POST',
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(rate),
            success: function (res) {
                console.log(res);
                alert("rating done");
                $("#ratesp").modal('hide');
                $("#tabs-Service-History").load("@Url.Action("CustomerServiceHistory","Home")");
            },
            error: function (err) {
                console.log(err);
                console.log("Error");
            }
        });
    });

</script>


